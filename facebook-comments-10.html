<script>
  window.addEventListener('message', receiveMessage, false);
  function receiveMessage(event) {
    if (event.data) {
      var msg;
      try {
        msg = JSON.parse(event.data);
      } catch (err) {}
      if (!msg)
        return false;
      if (msg.name === 'resize') {
        window.parent.postMessage({
          sentinel: 'amp',
          type: 'embed-size',
          height: msg.data.height
        }, '*');
      }
    }
  }
  function getQueryVariable(variable) {
    var query = window.location.search.substring(1);
    var vars = query.split('&');
    for (var i = 0; i < vars.length; i++) {
      var pair = vars[i].split('=');
      if (pair[0] == variable) {
        return pair[1];
      }
    }
    return (false);
  }
  var fb_root = document.createElement('DIV');
  fb_root.id = 'fb-root';
  document.body.appendChild(fb_root);
  var script = document.createElement('SCRIPT');
  script.setAttribute('async','');
  script.setAttribute('crossorigin','anonymous');
  script.setAttribute('src','https://connect.facebook.net/'+getQueryVariable('locale')+'/sdk.js#xfbml=1&version=v10.0&appId='+getQueryVariable('appId')+'&autoLogAppEvents=1');
  document.body.appendChild(script);
  var fb_comments = document.createElement('DIV');
  fb_comments.setAttribute('class','fb-comments');
  fb_comments.setAttribute('data-href',getQueryVariable('link'));
  fb_comments.setAttribute('data-width','');
  fb_comments.setAttribute('data-numposts',getQueryVariable('numposts'));
  document.body.appendChild(fb_comments);
</script>
